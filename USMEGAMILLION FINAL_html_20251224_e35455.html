<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>US Mega Millions Combinations Generator - 1-70 Choose 5</title>
    <style>
        body { 
            font-family: 'Arial', sans-serif; 
            margin: 0; 
            padding: 20px; 
            background: linear-gradient(135deg, #0c2461 0%, #1e3799 100%);
            min-height: 100vh;
        }
        .container { 
            max-width: 1300px; 
            margin: 0 auto; 
            background: white; 
            padding: 30px; 
            border-radius: 20px; 
            box-shadow: 0 15px 40px rgba(0,0,0,0.3); 
            border: 5px solid #ff6b6b;
        }
        .mega-header { 
            text-align: center; 
            margin-bottom: 40px; 
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%); 
            color: white; 
            padding: 30px; 
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(255,107,107,0.4);
            border: 3px solid #ffd700;
            position: relative;
            overflow: hidden;
        }
        .mega-header h1 { 
            margin: 0; 
            font-size: 42px; 
            color: #ffd700; 
            text-shadow: 3px 3px 0 #0c2461;
            letter-spacing: 1.5px;
        }
        .mega-subtitle { 
            color: #ffd700; 
            font-weight: 700; 
            font-size: 22px; 
            margin: 15px 0; 
        }
        .jackpot-display {
            background: #0c2461;
            color: white;
            padding: 15px;
            border-radius: 10px;
            display: inline-block;
            margin-top: 15px;
            border: 3px solid #ffd700;
            font-size: 18px;
            font-weight: 700;
        }
        .info-box { 
            background: linear-gradient(135deg, #0c2461 0%, #1e3799 100%); 
            color: white; 
            padding: 25px; 
            border-radius: 12px; 
            margin-bottom: 25px; 
            border: 3px solid #ff6b6b;
        }
        .info-box h3 { 
            margin-top: 0; 
            color: #ffd700; 
            font-size: 24px;
            border-bottom: 2px solid #ff6b6b;
            padding-bottom: 10px;
        }
        .combinations { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); 
            gap: 15px; 
            margin-top: 30px; 
        }
        .combo { 
            padding: 15px; 
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); 
            border: 3px solid #0c2461; 
            border-radius: 10px; 
            font-family: 'Courier New', monospace; 
            position: relative; 
            transition: all 0.3s; 
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            font-weight: 600;
        }
        .combo:hover { 
            transform: translateY(-5px); 
            box-shadow: 0 10px 20px rgba(0,0,0,0.2); 
            border-color: #ff6b6b; 
            background: linear-gradient(135deg, #ffffff 0%, #f1f3f5 100%);
        }
        .combo.searched { 
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%); 
            border-left: 6px solid #28a745; 
        }
        .combo.searched::before { 
            content: "üîç"; 
            position: absolute; 
            left: -10px; 
            top: -10px; 
            font-size: 16px; 
            background: #28a745; 
            border-radius: 50%; 
            width: 25px; 
            height: 25px; 
            text-align: center; 
            line-height: 25px; 
            border: 2px solid white;
        }
        .combo.exact-match { 
            background: linear-gradient(135deg, #ffd700 0%, #ffcc00 100%); 
            color: #0c2461; 
            border: 4px solid #ff6b6b; 
            animation: jackpot 1.5s infinite; 
            font-weight: 700;
        }
        @keyframes jackpot {
            0%, 100% { 
                transform: scale(1); 
                box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.7); 
            }
            50% { 
                transform: scale(1.05); 
                box-shadow: 0 0 0 15px rgba(255, 215, 0, 0); 
            }
        }
        .controls { 
            margin: 30px 0; 
            display: flex; 
            flex-wrap: wrap; 
            gap: 15px; 
            justify-content: center;
        }
        button { 
            padding: 14px 22px; 
            cursor: pointer; 
            border: none; 
            border-radius: 10px; 
            background: linear-gradient(135deg, #0c2461 0%, #1e3799 100%); 
            color: white; 
            font-weight: 700;
            font-size: 16px;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(12, 36, 97, 0.3);
            border: 2px solid #ff6b6b;
        }
        button:hover { 
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%); 
            transform: translateY(-3px); 
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.4);
        }
        button:active { 
            transform: translateY(0); 
        }
        .page-info { 
            margin: 25px 0; 
            padding: 20px; 
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); 
            border-radius: 12px; 
            font-weight: 700;
            border: 3px solid #0c2461;
            color: #0c2461;
            text-align: center;
            font-size: 18px;
        }
        .search-container { 
            margin: 30px 0; 
            padding: 30px; 
            background: linear-gradient(135deg, #ffd700 0%, #ffcc00 100%); 
            border-radius: 15px; 
            color: #0c2461;
            border: 4px solid #0c2461;
        }
        .search-container h3 { 
            margin-top: 0; 
            color: #0c2461; 
            font-size: 28px;
            text-shadow: 2px 2px 0 rgba(255,255,255,0.5);
        }
        .search-input { 
            padding: 15px; 
            width: 300px; 
            margin-right: 15px; 
            border: 3px solid #0c2461; 
            border-radius: 10px; 
            font-size: 18px;
            background: white;
            color: #0c2461;
            font-weight: 600;
        }
        .search-result { 
            margin-top: 25px; 
            padding: 20px; 
            border-radius: 10px; 
            font-weight: 600; 
            font-size: 16px;
            border: 3px solid;
        }
        .search-result.info { 
            background: rgba(12, 36, 97, 0.9); 
            color: white; 
            border-color: #ffd700; 
        }
        .search-result.not-found { 
            background: rgba(255, 255, 255, 0.95); 
            color: #c62828; 
            border-color: #ef5350; 
        }
        .stats { 
            background: linear-gradient(135deg, #ffd700 0%, #ffcc00 100%); 
            padding: 25px; 
            border-radius: 12px; 
            margin: 25px 0; 
            border: 3px solid #0c2461;
            color: #0c2461;
        }
        .stats h3 { 
            margin-top: 0; 
            color: #0c2461; 
            font-size: 26px;
            border-bottom: 3px solid #0c2461;
            padding-bottom: 10px;
        }
        .stats p {
            font-size: 18px;
            margin: 12px 0;
        }
        .navigation-buttons { 
            margin-top: 20px; 
            display: flex; 
            gap: 15px; 
            flex-wrap: wrap; 
            justify-content: center;
        }
        .search-history { 
            margin-top: 30px; 
            padding: 25px; 
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); 
            border-radius: 12px; 
            border: 3px solid #0c2461;
        }
        .history-item { 
            padding: 15px; 
            margin: 12px 0; 
            background: white; 
            border-radius: 10px; 
            cursor: pointer; 
            border-left: 6px solid #ff6b6b;
            transition: all 0.3s;
            box-shadow: 0 3px 8px rgba(0,0,0,0.1);
        }
        .history-item:hover { 
            background: #e3f2fd; 
            transform: translateX(10px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }
        .badge { 
            background: linear-gradient(135deg, #0c2461 0%, #1e3799 100%); 
            color: white; 
            padding: 5px 12px; 
            border-radius: 20px; 
            font-size: 13px; 
            margin-left: 10px; 
            font-weight: 700;
            border: 2px solid #ffd700;
        }
        .loading { 
            display: none; 
            color: #0c2461; 
            font-weight: 700; 
            margin-top: 20px; 
            font-size: 20px;
            text-align: center;
        }
        .loading.active { 
            display: block; 
        }
        input[type="number"] {
            padding: 12px;
            border: 3px solid #0c2461;
            border-radius: 10px;
            width: 120px;
            font-size: 18px;
            text-align: center;
            font-weight: 600;
            color: #0c2461;
        }
        .btn-primary { 
            background: linear-gradient(135deg, #28a745 0%, #218838 100%); 
            border-color: #155724; 
        }
        .btn-primary:hover { 
            background: linear-gradient(135deg, #218838 0%, #1e7e34 100%); 
        }
        .btn-danger { 
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); 
            border-color: #721c24; 
        }
        .btn-danger:hover { 
            background: linear-gradient(135deg, #c82333 0%, #bd2130 100%); 
        }
        .btn-mega { 
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%); 
            border-color: #ffd700; 
            font-size: 18px;
            padding: 16px 25px;
        }
        .mega-ball-note {
            background: #0c2461;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            border: 3px solid #ffd700;
            font-weight: 600;
        }
        .mega-ball {
            display: inline-block;
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            border-radius: 50%;
            color: white;
            text-align: center;
            line-height: 40px;
            font-weight: 700;
            margin: 0 5px;
            border: 2px solid #ffd700;
        }
        .combo-number {
            display: inline-block;
            width: 35px;
            height: 35px;
            background: linear-gradient(135deg, #0c2461 0%, #1e3799 100%);
            border-radius: 50%;
            color: white;
            text-align: center;
            line-height: 35px;
            font-weight: 700;
            margin: 0 3px;
            border: 2px solid #ffd700;
        }
        .mega-icon {
            font-size: 40px;
            margin-bottom: 20px;
            display: block;
        }
        .odds-display {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            margin: 25px 0;
            gap: 15px;
        }
        .odds-box {
            background: white;
            border-radius: 10px;
            padding: 20px;
            border: 3px solid #0c2461;
            text-align: center;
            flex: 1;
            min-width: 200px;
        }
        .odds-box h4 {
            margin-top: 0;
            color: #0c2461;
            border-bottom: 2px solid #ff6b6b;
            padding-bottom: 10px;
        }
        .jackpot-amount {
            font-size: 32px;
            color: #ff6b6b;
            font-weight: 900;
            text-shadow: 2px 2px 0 rgba(0,0,0,0.1);
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="mega-header">
            <div class="mega-icon">üé∞üí∞</div>
            <h1>US MEGA MILLIONS</h1>
            <p class="mega-subtitle">1 to 70 ‚Ä¢ Choose 5 Main Numbers ‚Ä¢ All Possible Combinations</p>
            <p>Complete mathematical generator for all 12,103,014 possible combinations</p>
            <div class="jackpot-display">
                üí∞ Current Jackpot Odds: 1 in 302,575,350 (with Mega Ball)
            </div>
        </div>
        
        <div class="odds-display">
            <div class="odds-box">
                <h4>üéØ Match 5 + Mega Ball</h4>
                <div class="jackpot-amount">JACKPOT</div>
                <p>Odds: 1 in 302,575,350</p>
            </div>
            <div class="odds-box">
                <h4>üéØ Match 5 Numbers</h4>
                <div class="jackpot-amount">$1,000,000</div>
                <p>Odds: 1 in 12,103,014</p>
            </div>
            <div class="odds-box">
                <h4>üéØ Match 4 + Mega Ball</h4>
                <div class="jackpot-amount">$10,000</div>
                <p>Odds: 1 in 931,001</p>
            </div>
        </div>
        
        <div class="mega-ball-note">
            ‚ö†Ô∏è Note: This generator shows all possible combinations for the 5 main numbers (1-70). 
            The Mega Ball (1-25) is not included as it's drawn separately. 
            Actual jackpot odds include both 5 main numbers AND the Mega Ball.
        </div>

        <div class="stats">
            <h3>üìä US MEGA MILLIONS - Mathematical Overview</h3>
            <p><strong>Total Main Number Combinations (1-70 choose 5):</strong> <span style="color: #ff6b6b; font-size: 24px;">12,103,014</span></p>
            <p><strong>Total Pages (1,000 per page):</strong> 12,104 pages</p>
            <p><strong>Mathematical Formula:</strong> C(70,5) = 70!/(5!√ó65!) = 12,103,014</p>
            <p><strong>With Mega Ball (1-25):</strong> 12,103,014 √ó 25 = 302,575,350 total jackpot combinations</p>
            <p><strong>Combinatorial System:</strong> Uses lexicographical ordering for instant calculation</p>
        </div>

        <div class="info-box">
            <h3>‚ú® About This Mega Millions Generator</h3>
            <p>This specialized mathematical tool generates <strong>ALL 12,103,014 possible combinations</strong> for the US Mega Millions 5 main numbers.</p>
            <p>Every valid combination from [1,2,3,4,5] to [66,67,68,69,70] is mathematically generated and can be located instantly.</p>
            <p><strong>Key Features:</strong> Exact position calculation, page navigation, search history, random samples, common patterns</p>
        </div>

        <div class="search-container">
            <h3>üîç Find Any Mega Millions Combination</h3>
            <p>Enter 5 numbers from 1-70 separated by commas (e.g., 5,15,25,35,45)</p>
            <input type="text" id="searchInput" class="search-input" placeholder="5,15,25,35,45">
            <button onclick="calculateExactPosition()" class="btn-primary">Find Exact Position</button>
            <button onclick="clearSearch()">Clear Search</button>
            <div id="loading" class="loading">üí∞ Calculating exact Mega Millions position...</div>
            <div id="searchResult" class="search-result"></div>
            <div id="navigationButtons" class="navigation-buttons"></div>
        </div>

        <div class="search-history" id="searchHistoryContainer" style="display: none;">
            <h4>üìã Search History (This Session)</h4>
            <p><small>Click on any previous search to navigate back to it</small></p>
            <div id="searchHistoryList"></div>
            <button onclick="clearSearchHistory()" class="btn-danger" style="margin-top: 15px;">Clear History</button>
        </div>

        <div class="controls">
            <button onclick="generateCombinations(1)" class="btn-mega">üí∞ First Page</button>
            <button onclick="generateCombinations(currentPage - 1)">‚Üê Previous Page</button>
            <button onclick="generateCombinations(currentPage + 1)">Next Page ‚Üí</button>
            <button onclick="goToSpecificPage()">Go to Page</button>
            <button onclick="downloadCurrentPage()">üíæ Download Page</button>
            <button onclick="generateRandomSample()">üé≤ Random Sample (100)</button>
            <button onclick="generateWinningPatterns()">üèÜ Common Patterns</button>
        </div>

        <div class="page-info">
            üìÑ Page: <span id="currentPage">0</span> of <span id="totalPages">12,104</span> | 
            Showing Combinations: <span id="comboRange">0-0</span> |
            Jump to Page: <input type="number" id="pageJumpInput" placeholder="Page #" min="1" max="12104">
        </div>

        <div id="combinationsContainer" class="combinations">
            <!-- Combinations will appear here -->
        </div>
        
        <div style="text-align: center; margin-top: 40px; padding: 25px; background: #0c2461; color: white; border-radius: 12px; border: 3px solid #ffd700;">
            <h3>üí∞ US MEGA MILLIONS Facts</h3>
            <p>‚Ä¢ Drawings: Tuesday and Friday nights at 11:00 PM ET</p>
            <p>‚Ä¢ Minimum jackpot: $20 million (rolls over if not won)</p>
            <p>‚Ä¢ Largest jackpot: $1.602 billion (August 2023)</p>
            <p>‚Ä¢ All 12,103,014 main number combinations are mathematically covered in this generator</p>
        </div>
    </div>

    <script>
        let currentPage = 0;
        const combosPerPage = 1000;
        const totalCombinations = 12103014; // C(70,5) = 12,103,014
        const totalPages = 12104;
        let currentCombinations = [];
        let lastSearchedCombination = null;
        
        // In-memory search history
        let searchHistory = [];

        // Pre-calculate binomial coefficients for faster computation
        const binomialCache = new Map();
        
        function binomialCoefficient(n, k) {
            if (k < 0 || k > n) return 0;
            if (k === 0 || k === n) return 1;
            
            const key = `${n},${k}`;
            if (binomialCache.has(key)) return binomialCache.get(key);
            
            let result = 1;
            for (let i = 1; i <= k; i++) {
                result = result * (n - k + i) / i;
            }
            
            binomialCache.set(key, Math.round(result));
            return Math.round(result);
        }

        document.getElementById('totalPages').textContent = totalPages.toLocaleString();
        updateSearchHistoryDisplay();

        function calculateLexicographicalPosition(combination) {
            const sortedCombo = [...combination].sort((a, b) => a - b);
            let position = 1;
            const n = 70;
            const k = 5;
            
            for (let i = 0; i < k; i++) {
                const currentNumber = sortedCombo[i];
                const prevNumber = (i === 0) ? 0 : sortedCombo[i - 1];
                
                for (let num = prevNumber + 1; num < currentNumber; num++) {
                    const remainingPositions = k - i - 1;
                    const remainingNumbers = n - num;
                    position += binomialCoefficient(remainingNumbers, remainingPositions);
                }
            }
            
            return position;
        }

        function getCombinationAtPosition(position) {
            if (position < 1 || position > totalCombinations) return null;
            
            let remaining = position - 1;
            const combo = [];
            let current = 1;
            const n = 70;
            const k = 5;
            
            for (let i = 0; i < k; i++) {
                const spotsLeft = k - i - 1;
                
                for (let num = current; num <= n; num++) {
                    const combs = binomialCoefficient(n - num, spotsLeft);
                    
                    if (remaining < combs) {
                        combo.push(num);
                        current = num + 1;
                        break;
                    } else {
                        remaining -= combs;
                    }
                }
            }
            
            return combo;
        }

        function generateCombinations(page) {
            if (page < 1) page = 1;
            if (page > totalPages) page = totalPages;
            
            const container = document.getElementById('combinationsContainer');
            const comboRange = document.getElementById('comboRange');
            const currentPageElem = document.getElementById('currentPage');
            
            container.innerHTML = '';
            currentPage = page;
            currentPageElem.textContent = currentPage.toLocaleString();
            
            const startIdx = (page - 1) * combosPerPage + 1;
            const endIdx = Math.min(startIdx + combosPerPage - 1, totalCombinations);
            comboRange.textContent = `${startIdx.toLocaleString()}-${endIdx.toLocaleString()}`;
            
            clearSearchHighlights();
            
            for (let i = 0; i < combosPerPage && (startIdx + i) <= totalCombinations; i++) {
                const comboNumber = startIdx + i;
                const combo = getCombinationAtPosition(comboNumber);
                
                const comboElement = document.createElement('div');
                comboElement.className = 'combo';
                comboElement.id = `combo-${comboNumber}`;
                
                const comboStr = JSON.stringify(combo);
                const isSearched = searchHistory.some(item => item.comboStr === comboStr);
                if (isSearched) {
                    comboElement.classList.add('searched');
                }
                
                if (lastSearchedCombination && JSON.stringify(combo) === JSON.stringify(lastSearchedCombination.combination)) {
                    comboElement.classList.add('exact-match');
                }
                
                // Format with number circles
                const comboDisplay = combo.map(num => 
                    `<span class="combo-number">${num}</span>`
                ).join(' ');
                
                comboElement.innerHTML = `
                    <div style="color: #0c2461; margin-bottom: 8px; font-size: 14px;">
                        Combination #${comboNumber.toLocaleString()}
                    </div>
                    <div style="font-size: 18px; margin: 10px 0;">
                        ${comboDisplay}
                    </div>
                    <div style="font-size: 12px; color: #666;">
                        [${combo.join(', ')}]
                    </div>
                `;
                container.appendChild(comboElement);
            }
            
            if (lastSearchedCombination) {
                setTimeout(() => {
                    const exactMatch = document.querySelector('.combo.exact-match');
                    if (exactMatch) {
                        exactMatch.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                }, 100);
            }
        }

        function goToSpecificPage() {
            const pageInput = document.getElementById('pageJumpInput');
            const pageNum = parseInt(pageInput.value);
            if (!isNaN(pageNum) && pageNum >= 1 && pageNum <= totalPages) {
                generateCombinations(pageNum);
            } else {
                alert(`Please enter a page number between 1 and ${totalPages.toLocaleString()}`);
            }
        }

        function generateRandomSample() {
            const container = document.getElementById('combinationsContainer');
            const comboRange = document.getElementById('comboRange');
            const currentPageElem = document.getElementById('currentPage');
            
            container.innerHTML = '';
            currentPage = 0;
            currentPageElem.textContent = 'Random Sample';
            comboRange.textContent = '100 random Mega Millions combinations';
            
            clearSearchHighlights();
            
            for (let i = 1; i <= 100; i++) {
                const randomPos = Math.floor(Math.random() * totalCombinations) + 1;
                const combo = getCombinationAtPosition(randomPos);
                
                const comboElement = document.createElement('div');
                comboElement.className = 'combo';
                comboElement.id = `combo-${i}`;
                
                const comboStr = JSON.stringify(combo);
                const isSearched = searchHistory.some(item => item.comboStr === comboStr);
                if (isSearched) {
                    comboElement.classList.add('searched');
                }
                
                const comboDisplay = combo.map(num => 
                    `<span class="combo-number">${num}</span>`
                ).join(' ');
                
                comboElement.innerHTML = `
                    <div style="color: #ff6b6b; margin-bottom: 8px; font-size: 14px;">
                        üé≤ Random #${i}
                    </div>
                    <div style="font-size: 18px; margin: 10px 0;">
                        ${comboDisplay}
                    </div>
                    <div style="font-size: 12px; color: #666;">
                        Position: ${randomPos.toLocaleString()}
                    </div>
                `;
                container.appendChild(comboElement);
            }
        }

        function generateWinningPatterns() {
            const container = document.getElementById('combinationsContainer');
            const comboRange = document.getElementById('comboRange');
            const currentPageElem = document.getElementById('currentPage');
            
            container.innerHTML = '';
            currentPage = 0;
            currentPageElem.textContent = 'Common Mega Millions Patterns';
            comboRange.textContent = 'Historical and statistical patterns';
            
            clearSearchHighlights();
            
            // Common Mega Millions patterns
            const patterns = [
                {name: "All Low", combo: [3,7,11,15,19], desc: "All numbers under 20"},
                {name: "All High", combo: [51,55,59,63,67], desc: "All numbers over 50"},
                {name: "Even Spread", combo: [10,20,30,40,50], desc: "Multiples of 10"},
                {name: "Odd Only", combo: [5,17,29,41,53], desc: "All odd numbers"},
                {name: "Even Only", combo: [8,22,36,44,58], desc: "All even numbers"},
                {name: "Sequential", combo: [15,16,17,18,19], desc: "5 consecutive numbers"},
                {name: "Birthday Range", combo: [1,12,23,28,31], desc: "Common dates (1-31)"},
                {name: "Hot Numbers", combo: [10,14,31,39,55], desc: "Frequently drawn"},
                {name: "Cold Numbers", combo: [6,21,33,47,62], desc: "Rarely drawn"},
                {name: "Fibonacci", combo: [3,5,8,13,21], desc: "Fibonacci sequence"},
                {name: "Prime Numbers", combo: [2,3,5,7,11], desc: "First 5 primes"},
                {name: "Quintiles", combo: [14,28,42,56,70], desc: "One from each quintile"},
                {name: "Sum ~175", combo: [23,31,37,41,43], desc: "Sum around average (175)"},
                {name: "Low Sum", combo: [1,2,3,4,65], desc: "Very low sum"},
                {name: "High Sum", combo: [6,65,66,67,68], desc: "Very high sum"},
            ];
            
            patterns.forEach((pattern, index) => {
                const position = calculateLexicographicalPosition(pattern.combo);
                const sum = pattern.combo.reduce((a,b) => a + b, 0);
                
                const comboElement = document.createElement('div');
                comboElement.className = 'combo';
                comboElement.id = `pattern-${index}`;
                comboElement.style.background = 'linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%)';
                comboElement.style.border = '3px solid #0c2461';
                
                const comboDisplay = pattern.combo.map(num => 
                    `<span class="combo-number">${num}</span>`
                ).join(' ');
                
                comboElement.innerHTML = `
                    <div style="font-weight: bold; color: #0c2461; font-size: 18px; margin-bottom: 10px;">
                        ${pattern.name}
                    </div>
                    <div style="font-size: 20px; margin: 10px 0;">
                        ${comboDisplay}
                    </div>
                    <div style="font-size: 13px; color: #666; margin-bottom: 8px;">
                        ${pattern.desc}
                    </div>
                    <div style="display: flex; justify-content: space-between; font-size: 12px;">
                        <span style="color: #0c2461;">Pos: ${position.toLocaleString()}</span>
                        <span style="color: #ff6b6b;">Sum: ${sum}</span>
                    </div>
                `;
                container.appendChild(comboElement);
            });
        }

        function calculateExactPosition() {
            const searchInput = document.getElementById('searchInput').value;
            const searchResult = document.getElementById('searchResult');
            const navigationButtons = document.getElementById('navigationButtons');
            const loading = document.getElementById('loading');
            
            clearSearchHighlights();
            navigationButtons.innerHTML = '';
            
            if (!searchInput.trim()) {
                searchResult.innerHTML = '<span style="color: #666;">Please enter Mega Millions numbers to search</span>';
                return;
            }
            
            let searchNumbers;
            try {
                searchNumbers = searchInput.split(',')
                    .map(num => parseInt(num.trim()))
                    .filter(num => !isNaN(num) && num >= 1 && num <= 70);
                    
                if (searchNumbers.length !== 5) {
                    searchResult.innerHTML = '<span style="color: #c62828;"><strong>Error:</strong> Mega Millions requires exactly 5 numbers between 1 and 70</span>';
                    searchResult.className = 'search-result not-found';
                    return;
                }
                
                if (new Set(searchNumbers).size !== 5) {
                    searchResult.innerHTML = '<span style="color: #c62828;"><strong>Error:</strong> Duplicate numbers found. Please enter 5 unique numbers.</span>';
                    searchResult.className = 'search-result not-found';
                    return;
                }
                
                searchNumbers.sort((a, b) => a - b);
                
            } catch (error) {
                searchResult.innerHTML = '<span style="color: #c62828;"><strong>Error:</strong> Invalid format. Use: 5,15,25,35,45</span>';
                searchResult.className = 'search-result not-found';
                return;
            }
            
            loading.classList.add('active');
            searchResult.innerHTML = '';
            
            setTimeout(() => {
                const exactPosition = calculateLexicographicalPosition(searchNumbers);
                const exactPage = Math.ceil(exactPosition / combosPerPage);
                const sum = searchNumbers.reduce((a,b) => a + b, 0);
                
                lastSearchedCombination = {
                    combination: searchNumbers,
                    exactPosition: exactPosition,
                    exactPage: exactPage,
                    sum: sum
                };
                
                addToSearchHistory(searchNumbers, exactPosition, exactPage, sum);
                
                const comboDisplay = searchNumbers.map(num => 
                    `<span class="combo-number">${num}</span>`
                ).join(' ');
                
                searchResult.innerHTML = `
                    <div style="font-size: 24px; color: #ffd700; margin-bottom: 15px;">
                        üé∞ MEGA MILLIONS COMBINATION FOUND!
                    </div>
                    <div style="font-size: 22px; margin: 15px 0;">
                        ${comboDisplay}
                    </div>
                    <div style="font-size: 18px; margin: 10px 0;">
                        <strong>Exact Position:</strong> ${exactPosition.toLocaleString()} of ${totalCombinations.toLocaleString()}
                    </div>
                    <div style="font-size: 18px; margin: 10px 0;">
                        <strong>Page Location:</strong> ${exactPage.toLocaleString()} of ${totalPages.toLocaleString()}
                    </div>
                    <div style="font-size: 16px; margin: 10px 0;">
                        <strong>Sum of numbers:</strong> ${sum} (Average sum is 177.5)
                    </div>
                    <div style="font-size: 14px; color: #ccc; margin-top: 15px;">
                        Using combinatorial mathematics for US Mega Millions
                    </div>
                `;
                searchResult.className = 'search-result info';
                
                navigationButtons.innerHTML = `
                    <button onclick="goToExactPage(${exactPage})" class="btn-primary" style="font-size: 20px; padding: 18px 30px;">
                        üöÄ Go to Page ${exactPage.toLocaleString()}
                    </button>
                    <button onclick="goToNearbyPage(${exactPage}, -5)" style="font-size: 16px;">
                        ‚Üê 5 Pages Back
                    </button>
                    <button onclick="goToNearbyPage(${exactPage}, 5)" style="font-size: 16px;">
                        5 Pages Forward ‚Üí
                    </button>
                `;
                
                loading.classList.remove('active');
                goToExactPage(exactPage);
                
            }, 100);
        }

        function addToSearchHistory(combination, exactPosition, exactPage, sum) {
            const comboStr = JSON.stringify(combination);
            const timestamp = new Date().toLocaleString();
            
            const existingIndex = searchHistory.findIndex(item => item.comboStr === comboStr);
            
            const historyItem = {
                combination: [...combination],
                comboStr: comboStr,
                exactPosition: exactPosition,
                exactPage: exactPage,
                sum: sum,
                timestamp: timestamp
            };
            
            if (existingIndex !== -1) {
                searchHistory[existingIndex] = historyItem;
            } else {
                searchHistory.unshift(historyItem);
                if (searchHistory.length > 20) {
                    searchHistory.pop();
                }
            }
            
            updateSearchHistoryDisplay();
        }

        function updateSearchHistoryDisplay() {
            const historyContainer = document.getElementById('searchHistoryContainer');
            const historyList = document.getElementById('searchHistoryList');
            
            if (searchHistory.length === 0) {
                historyContainer.style.display = 'none';
                return;
            }
            
            historyContainer.style.display = 'block';
            historyList.innerHTML = '';
            
            searchHistory.forEach((item, index) => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                
                const comboDisplay = item.combination.map(num => 
                    `<span style="display: inline-block; width: 25px; height: 25px; background: #0c2461; color: white; border-radius: 50%; text-align: center; line-height: 25px; margin: 0 2px; font-size: 12px;">${num}</span>`
                ).join('');
                
                historyItem.innerHTML = `
                    <div style="font-weight: bold; color: #0c2461; margin-bottom: 5px;">
                        ${comboDisplay}
                    </div>
                    <div style="display: flex; justify-content: space-between; font-size: 13px;">
                        <span>
                            <span class="badge">Pos: ${item.exactPosition.toLocaleString()}</span>
                            <span class="badge">Page: ${item.exactPage.toLocaleString()}</span>
                            <span class="badge">Sum: ${item.sum}</span>
                        </span>
                        <small style="color: #666;">${item.timestamp}</small>
                    </div>
                `;
                historyItem.onclick = () => {
                    document.getElementById('searchInput').value = item.combination.join(', ');
                    lastSearchedCombination = {
                        combination: item.combination,
                        exactPosition: item.exactPosition,
                        exactPage: item.exactPage,
                        sum: item.sum
                    };
                    goToExactPage(item.exactPage);
                };
                historyList.appendChild(historyItem);
            });
        }

        function clearSearchHistory() {
            if (confirm('Clear all Mega Millions search history for this session?')) {
                searchHistory = [];
                updateSearchHistoryDisplay();
                generateCombinations(currentPage);
            }
        }

        function goToExactPage(page) {
            document.getElementById('pageJumpInput').value = page;
            generateCombinations(page);
        }

        function goToNearbyPage(centerPage, offset) {
            const newPage = centerPage + offset;
            if (newPage >= 1 && newPage <= totalPages) {
                goToExactPage(newPage);
            }
        }

        function downloadCurrentPage() {
            const combos = Array.from(document.querySelectorAll('.combo'))
                .map(el => {
                    const text = el.innerText || el.textContent;
                    return text.replace(/üé≤ Random #\d+|üí∞ Combination #\d+|üîç/g, '').trim();
                })
                .join('\n');
            
            const blob = new Blob([`US MEGA MILLIONS Combinations - Page ${currentPage}\nGenerated: ${new Date().toLocaleString()}\nTotal Combinations: 12,103,014\n\n${combos}`], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `US_MegaMillions_Page_${currentPage}_Combinations.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function clearSearch() {
            document.getElementById('searchInput').value = '';
            document.getElementById('searchResult').innerHTML = '';
            document.getElementById('searchResult').className = 'search-result';
            document.getElementById('navigationButtons').innerHTML = '';
            document.getElementById('loading').classList.remove('active');
            lastSearchedCombination = null;
            clearSearchHighlights();
        }

        function clearSearchHighlights() {
            const highlighted = document.querySelectorAll('.combo.exact-match');
            highlighted.forEach(el => {
                el.classList.remove('exact-match');
            });
        }

        // Initialize with first page
        generateCombinations(1);
        
        // Add Mega Ball explanation
        document.addEventListener('DOMContentLoaded', function() {
            const note = document.createElement('div');
            note.className = 'mega-ball-note';
            note.innerHTML = `
                <div style="margin-bottom: 10px;">
                    <span class="mega-ball">MB</span> = Mega Ball (1-25, drawn separately)
                </div>
                <div>
                    This generator shows <strong>ALL 12,103,014 combinations</strong> for the 5 main numbers.
                    For complete jackpot odds (1 in 302,575,350), multiply by 25 possible Mega Balls.
                </div>
            `;
            document.querySelector('.stats').after(note);
        });
    </script>
</body>
</html>